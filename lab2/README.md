–õ–∞–±–∞ ‚Ññ2

–ü–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ–ª –≥–∞–π–¥–∏–∫–∏ –ø–æ –¥–æ–∫–µ—Ä—É

–í –º–æ–µ–º –¥–æ–∫–µ—Ä —Ñ–∞–π–ª–µ –±—ã–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã —Å–ª–µ–¥—É—â–∏–µ practices:
Bad - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ :latest (FROM python:latest)
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ (vim, curl, git, gcc, make, tree, htop)
–•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ GitHub —á–µ—Ä–µ–∑ ENV (ENV GITHUB_TOKEN=) –¥–æ–∫–µ—Ä –¥–∞–∂–µ —Å–∞–º —Ä—É–≥–∞–µ—Ç
–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤–Ω—É—Ç—Ä–∏ Dockerfile (RUN git clone)
–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ—Ç root (USER root)

–ü–æ–ª—É—á–∏–ª–æ—Å—å –≤–æ—Ç —Ç–∞–∫–æ–µ - 
![–ö–æ–¥](./code_bad.png)

–ó–∞–±–∏–ª–¥–∏–ª - 
![–ë–∏–ª–¥](./bad_build.png)

–ò –ø–æ—Å–ª–µ —Ä–∞–Ω–∞ —Å–ª–æ–≤–∏–ª –æ—à–∏–±–∫—É -
![–û—à–∏–±–∫–∞](./bad_first_run.png)

–°–ø—É—Å—Ç—è –ø—è—Ç—å –º–∏–Ω—É—Ç –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ –ø–æ–Ω—è–ª —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–∏–Ω–æ—á–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ :)
![–ü–æ–±–µ–¥–∞](./bad_fixed_run.png)

–¢–µ–ø–µ—Ä—å –ø–æ—á–∏–Ω–∏–º –≥–∞–¥–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —è –Ω–∞–ø–∏—Å–∞–ª 


–î–æ–±—Ä—ã–π –∫–æ–¥(–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π)
![–î–æ–±—Ä—ã–π –∫–æ–¥(–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π)](./code_good.png)

–î–æ–±—Ä—ã–π –±–∏–ª–¥
![–ü–æ–±–µ–¥–∞](./good_build.png)

–î–æ–±—Ä—ã–π —Ä–∞–Ω
![–î–æ–±—Ä—ã–π —Ä–∞–Ω](./good_run.png)

–í–æ–æ–±—â–µ–º –∏—Å–ø—Ä–∞–≤–∏–ª -
FROM python:latest -> FROM python:3.10-slim
—Ç–µ–ø–µ—Ä—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Python

–£–¥–∞–ª–∏–ª —É—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ (vim, curl –∏ —Ç.–¥.)
–æ–±—Ä–∞–∑ —Å—Ç–∞–ª –º–µ–Ω—å—à–µ, —Å–±–æ—Ä–∫–∞ –±—ã—Å—Ç—Ä–µ–µ

–£–¥–∞–ª–∏–ª —Ö—Ä–∞–Ω–µ–Ω–∏–µ GitHub-—Ç–æ–∫–µ–Ω–∞ (ENV GITHUB_TOKEN=)
—Ç–æ–∫–µ–Ω –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ–±—Ä–∞–∑ –∏ –Ω–µ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä—É–µ—Ç—Å—è ( $$$ )

–£–¥–∞–ª–∏–ª git clone –∏–∑ Dockerfile
—Ç–µ–ø–µ—Ä—å –∫–æ–¥ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (COPY . /app)

–°–æ–∑–¥–∞–ª –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è appuser –≤–º–µ—Å—Ç–æ root
–ø–æ–≤—ã—Å–∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ( –≤ —É–º–Ω—ã–µ –≤–µ—â–∏ —Ç–æ–∂–µ –º–æ–≥—É üòé )

–î–æ–±–∞–≤–∏–ª RUN chown -R appuser:appuser /app
—á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–ª –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é ( üòé ) 

–î–æ–±–∞–≤–∏–ª USER appuser
–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–¥ –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –Ω–µ root ( üòé )

–ö–∞–∫ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≥–∞–¥–æ—Å—Ç–∏ –¥–∞–∂–µ —Å —Ö–æ—Ä–æ—à–∏–º –¥–æ–∫–µ—Ä —Ñ–∞–π–ª–æ–º 
1.–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ—Ç root
–î–∞–∂–µ –µ—Å–ª–∏ –¥–æ–∫–µ—Ä —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –±–µ–∑–æ–ø–∞—Å–Ω–æ, –º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç root.
–≠—Ç–æ –æ–ø–∞—Å–Ω–æ: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —á—Ç–æ —Ç–æ –≤–∞–∂–Ω–æ–µ.

2.–î–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º –ø–∞–ø–∫–∞–º –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
–ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –¥–æ—Å—Ç—É–ø –∫ –±–æ–ª—å—à–∏–º –ø–∞–ø–∫–∞–º –Ω–∞ —Ö–æ—Å—Ç–µ (-v /home/user:/app), –æ–Ω —Å–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã.
–õ—É—á—à–µ –¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. ( —ç—Ç–æ –Ω–∞ —Å—Ç–∞–∫–æ–≤–µ—Ä—Ñ–ª–æ—É –Ω–∞–ø–∏—Å–∞–Ω–æ )

–í—ã–≤–æ–¥—ã
–°–±–æ—Ä–∫–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π, –±–µ–∑–æ–ø–∞—Å–Ω–æ–π, –±—ã—Å—Ç—Ä–µ–µ –∏ –ª–µ–≥—á–µ.
–ò —è –∑–Ω–∞—é, —á—Ç–æ –Ω–µ –∑–∞–º–∞–∑–ª —Ç–æ–∫–µ–Ω –≤ –±–∏–ª–¥–∞—Ö. –û–Ω —É–∂–µ –æ—Ç–∫–ª—é—á–µ–Ω ( üòé )










